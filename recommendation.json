{
  "Architecture": [
    "The ratio of CO2 emissions coming from the manufacturing phase and the CO2 from the usage phase varies a lot and depends on several factors like the carbon intensity of the electricity used to power the datacenter and the datacenter infrastructure's own efficiency (PUE, cooling, etc.).",
    "Most of our recommendations applies to the server, storage and network categories, as we consider that the efficiency of cooling and Uninterruptible Power Supply is worked on by those responsible for running this infrastructure (DC managers, Ops, etc.) and actions on these items are not actionable by developers and project's stakeholders in general.",
    "This section does not intend to give you a detailed overview of this architecture style, which would include its advantages, drawbacks and potholes (many books and websites are already available on that topic and cover it much better than what we could write here).",
    "We give below a short definition for each of these categories; these definitions are by no mean reference materials but should be enough to ensure we have a common vocabulary.",
    "It should be noted that many consider the microservice style to be mainly an answer to organization and size issues more than a technical matter: this approach allows to have one small-sized team (it's called the two-pizza team rule, 5 to 7 persons, and originates at amazon) for each microservice.",
    "We name Hybrid architectures the architectures that do not follow exactly one of the aforementioned styles.",
    "To have a full overview of the current trends in architecture styles, we should probably also mention the Function as a Service (FaaS) or Lambda approach, which can be seen as the microservices idea pushed to the extreme: components are shrinked to even smaller size, up to a single function, and are instantiated and executed only when they are actually used.",
    "Regarding architecture, we should also have a look at Event Driven Architecture impact",
    "Recommendation: We recommend using a monolith or modular monolith approach [1] for small and simple applications, when you can predict that the application will not grow significantly neither in complexity nor in the number of users.",
    "Additionally we advise against converting to a microservice architecture a monolith application that matches these criteria.",
    "When working on an application that has a good chance to grow in scale or complexity, we recommend to use a modular monolith approach.",
    "Although this decision was not made for environmental footprint, it demonstrates that a modular architecture works and that scalability needs do not mandate the use of microservices.",
    "These variants should also be investigated and are encompassed in this recommendation as long as they maintain the aforementioned benefits.",
    "Additionally, one must note that most of the expected benefits (differential scaling, etc.) can also be obtained by a well thought hybrid architecture as described in the introduction of this section.",
    "When developing a large and complex application that must scale to a large number of users, we recommend using a modular approach such as microservices or an hybrid architecture.",
    "When maintaining a large and complex monolith application, we recommend migrating to a modular architecture with several separated deployment unit, like an hybrid or microservice architecture.",
    "Impact:  (depending on whether measure is on the service end to end ou only on Orange side)",
    "This situation impacts the cost of the solution but also increase the energy required to build and run it: many systems, many network flows, many equipments (including the cost of building them).",
    "Ask the question whether expanding the existing functionality or creating a new one (1st scenario shall be preferred)",
    "Build architecture with fewer layers (for instance, consumption follow up is empowered in France through 6 softwares end to end)",
    "This impact comes from the network infrastructure itself, but also from the computing power required to process the data (serializing, encrypting, etc.).",
    "Design APIs to maximize the ratio of useful payload.",
    "design of APIs,",
    "Cache-aside strategy This strategy aims to improve reading performance.",
    "This strategy works well in a system that is heavily used in reading, rather than writing.",
    "if there are readings, this system should in general be coupled with the read-through strategy.",
    "minimize the configuration required for these servers,",
    "A CaaS (Container-as-a-Service) is a form of infrastructure sharing which is based on containers (instead of virtual machines typically used in an IaaS) ; it provides its users with a mechanism for managing and orchestrating their containers as well as the underlying necessary material resources, generally shared within an IaaS.",
    "Moreover, users have to deal with the complexity of infrastructure management",
    "Avoid installing custom project-specific private runners (and build infrastructure in general).",
    "The log level should be configurable and modifiable, at runtime, at the component / module granularity.",
    "Recommendation: The targeted infrastructure on which the application will be deployed in production should be chosen depending on its SLA level."
  ],
  "Communications": [
    "We are still looking for new contributors to help us identifying patterns and good practices in this area, if you are interested\nand / or are knowledgeable in this topic, please join us !",
    "For example, the ADEME, the French environmental agency, indicates that the CO2 impact of mobile communication can be estimated at 50 gCO2e/Go and that for fixed lines a flat rate of 3,95 kgCO2e per month per subscriber should be used.",
    "In general, the main focus for external communications should be on reducing the amount of data transferred, especially when the exchange is likely to happen on a mobile communication, like for example for an API used by a mobile application or a website.",
    "Design your application to minimize communication requirements and data transfer.",
    "Use communication patterns such as GraphQL, which can avoid sending many separate requests when displaying a data-rich page.",
    "Use protocols that are network-efficient: for example HTTP2, BSON, Protobuf, etc.",
    "Perform a risk analysis for major communication flow to decide if encryption is really required and only use encryption when needed. When encryption is required, use an encryption level that matches the risk identified during analysis. Of course, security requirements are paramount and must not be undermined when working on the environmental footprint of the application.",
    "Use compression whenever possible and select carefully the compression algorithm to keep a balance between the resources required for the compression and decompression and the gain obtained on the network side. Consider also the number of times you will have to perform compression and decompression (these operations are not always symmetrical).",
    "The cache should be positioned as close as possible to the user application, in order to reduce connection time and network traffic.",
    "IaaS: while VM-based server sharing is much better than dedicated servers, servers still have a relatively low utilization rate (< 30% on average) due to provisioning issues (especially memory)."
  ],
  "Cache": [
    "When and how to select a cache in order to make energy consumption relevant?",
    "The cache must embed a business layer (in order to update the database)",
    "When a cache is set up, it is important to check that the assumptions taken into account for its implementation are the right ones.",
    "From an environmental point of view, this measure may not be enough: if a cache can be considered effective as soon as it exceeds a 50% hit rate, it has its own impact, which must be offset by gains on hidden systems",
    "the need to refresh a data: most cache systems allow to manage a TTL (Time To Live) applicable separately to each data",
    "As with any system, it will be necessary to use:",
    "Avoid multiple repositories for same kind of data (in some cases, it is necessary to replicate data for aggregation and/or caching uses).",
    "BACKEND-OPS-6: Best practices for distributed traces"
  ],
  "Programming languages and execution environment": [
    "Moreover, we believe that acting on energy and hardware efficiency is currently the easiest way for projects to reduce the footprint of their application.",
    "Carbon awareness is the idea that software could adapt dynamically to the carbon intensity of the energy it consumes and uses technics such as workload shifting (time and space) to adapt its energy consumption to the availability of low carbon energy.",
    "Storage might be considered as less important when looking at this graph, however the embodied carbon of storage equipments (especially SSD) is extremely high, therefor it is paramount to work on storage, even if the energy used at runtime is relatively low.",
    "We have divided our recommendations for backend applications into several sections, each focusing on one specific aspect:",
    "Programming Languages and frameworks used to develop the application",
    "It is also often seen as a good way to help of potential future transition to a microservice style (either from the start or through refactoring), if the application ever needs it.",
    "The goal is to avoid tight coupling between components of the application and to have smaller components, with reduced complexity, which can each be developed and tested by a single team.",
    "While this approach might be beneficial, we do not include it in this version of the recommendation, mainly due to lack of concrete experience and feedback.",
    "When building an application whose scaling requirements are uniform, we recommend to use a modular monolith (as there is a single deployment unit, scaling independently separate parts of the application is not possible with a monolith, modular or not)",
    "When maintaining a monolithic application whose complexity or scale increases over time, we recommend migrating progressively to a modular monolith.",
    "When running large and/or complex applications that need to handle a big number of users, microservices can allow for very interesting energy-focused optimizations:",
    "Rationale The overall goal of this recommendation is to reduce the amount of resources required to provide a feature, with reduces both the energy cost for developing it, for running it and the footprint associated with the manufacturing or the servers used to run it.",
    "With WEB solutions taking the floor, projects involved decoupling fronts software from the backend, in order to ease frequent evolutions of the front.",
    "In order to simplify the overall IT, a program named “SI+” targeted redundant applications in order to decommission them.",
    "An API was created in order to isolate front end from backend where software simplification is on-going",
    "A shared transverse service to collect and dispatch logs \"As A Service\" should allow every application to distribute its logs to the different services/needs and avoid to implement such service by itself:",
    "Avoid unnecessarily dividing your application into modules or services that use the network to communicate with one another (of course such division might be useful and necessary, see the recommendations on architectures).",
    "TLS 1.3 is known to have a lower footprint than previous version and should be used preferably when possible.",
    "all text-based protocols should always be compressed using a compression algorithm such as gzip (cheap to decode and universally supported)",
    "When data are not reproducible (specific for each access, very low reuse, freshness requirement with frequent changes), you should not use cache.",
    "The main advantage of this cache is to provide fresh data in a first place: It is useful for applications with high traffics, coupling this strategy with the read-through strategy.",
    "From an environmental point of view, the objectives of the choice of a language for the backend of an application should be:",
    "first and foremost to minimize the number of servers required for a given application,",
    "while maintaining short response times (to avoid users renewing their\nterminals thinking that they are the cause of the slowness of some services),",
    "minimize the number of server resources required for a given application,",
    "offer short response times (so that users do not have to worry about renewing their terminals thinking that they are the cause of the slowness of some services).",
    "Recommendation: use a language recognized for its speed of execution for applications with high CPU usage",
    "we recommend avoiding less performing languages (Javascript, Typescript, Php, Python, Ruby...).",
    "Recommendation: Use an asynchronous language or framework for applications that are I/O intensive.",
    "Java on the JVM, using a framework such as Vert.x, Spring Webflux / MVC Async; while performance is generally good, the memory required to run the JVM itself is quite large.",
    "PHP: this is not the best choice for this use case.",
    "Python is not recommended for this use case, but if it is used in spite of everything, it is essential to use a framework based on AsyncIO.",
    "End users still have to configure and manage platform and environment and deploy applications on it.",
    "Deploy applications in a IaaS/CaaS/PaaS AND optimize this hosting to avoid rebound effect (see. BACKEND-DTIT-02)",
    "Adjusting the configuration of its application as best as possible minimizes resource consumption.",
    "Sobriety is required to avoid the rebound effect, where the increase of efficiency and/or ease of use of a resource actually leads to lower than expected savings or even to an increased usage (in which case it is called as the Jevons Paradox).",
    "Development environments should not be sized like production environments.",
    "Recommendation: Monitor its application in operational conditions (even for the development environment) to refine the resource quotas defined in the PaaS and not to reserve more resources than necessary.",
    "Use the generally non-redundant pre-production environments for development and integration.",
    "Other factors include the materials used to build the datacenter, the power consumption to ensure the operation of its infrastructure and equipments, the reuse of the heat produced, the tonnage of waste of electrical and electronic equipment (WEEE) produced each year by the datacenter...",
    "Recommendation: Give preference to environment friendly datacenters.",
    "Recommendation: When using Gitlab-CI, use the shared runners [1] & [2] provided by the team responsible for managing the build infrastructure (i.e.",
    "If not, use the tags in the commit messages to avoid launching them (usually [ci skip]).",
    "Rationale: Any device that does not require permanent operation must be switched off (not put on standby).",
    "Recommendation: Implement processes to shut down equipment that is not in use.",
    "Use Distroless images: If you are looking for small container images, the distroless approach reduces the size of the base layer.",
    "Cloud Native Buildpacks: Buildpacks allow you to convert your source code into a secure, efficient, production ready container image.",
    "Buildpacks make it easy to add bill of material stored as metadata in your image: SBOM can then be used to raise some Warnings related to the type of dependencies included in the image and especially licenses of those dependencies (GPL, ...).",
    "Recommendation: When using open-source projects, by default the resources are downloaded from public repositories (Docker images, Python packages, ...).",
    "However, the application should normally spend most of its existence in production, i.e.",
    "Therefore, we believe that developers should be more aware of the consequences of their decision and aim at allowing the ops to optimize the energy consumption of the application during the production phase.",
    "To prevent log files from being too large, they regularly undergo a rotate operation that consists in archiving the current log file to start again the recording of application traces in a new log file.",
    "However, the determination of the logs to be generated must take into account the constraints of the Ops in order to allow them to follow the activity of the application, to see the warnings and errors that have occurred on the production platforms.",
    "Operators should be able to choose the level of verbosity of the application to display only errors and warnings in production, but also all information and notifications when in the test phase.",
    "Each platform has its own SLA and you should choose your deployment platform depending on the non-functional operating requirements that you have defined for your application (see previous recommendation).",
    "Recommendation: It is therefore possible to upscale the deployment of the application when its load and activity increase.",
    "It is also important to downscale the deployment of the application when its load and activity decrease.",
    "In both cases, the sizing of the deployment must be adapted to the load of the application in order to meet the users' needs while limiting energy consumption.",
    "Besides using a hosting infrastructure that provides support for such mechanism, it is also necessary to implement the components of the application with languages and framework that allow a fast startup time and a small (memory and disk) footprint, see the language recommendation.",
    "This method allows observing the path followed by a transaction through all the services handling it.\nThese traces help detecting performance issues and useless calls in dev or production, leading to having more efficient transactions by focusing on what's important first in the overall user experience.",
    "Stop producing redundant log data (access logs mostly) once distributed traces are in place and well used by Ops and Devs:\nBeing able to remove access logs assumes you are also producing metrics directly from your application (à la Prometheus) and you are not relying on a backend aggregation of your access logs.",
    "Recommendation: This recommendation is written within the framework of good development practices, and therefore mainly intended for developers.",
    "However, it is advisable to prepare for the decommissioning of the application - which will take place one day or another - by listing all the resources used for the application and then delivering this document to the operations team.",
    "Recommendation: When the project team is disbanded, this team is responsible for decommissioning all development and qualification servers:"
  ],
  "Data": [
    "This course of action is currently not included in this document but should be worked on once the required maturity is reached.",
    "Moreover, other kinds of impacts (water, resources, rare metals, etc.) should not be ignored and could be worked on in future versions of this document.",
    "This document is, and will probably always stay, a work in progress.",
    "To be cost-effective, the requested data must be frequently found in the cache.",
    "The cache is much more energy efficient than the database, which must execute complex queries.",
    "limit the amount of data stored in the cache, and therefore its size,",
    "limit the calculations to be performed each time the data is retrieved (enrichment, formatting, etc.).",
    "the data write requires two separate network connections, instead of one in case the cache and database are managed independently",
    "BACKEND-CACHE-05: How to manage data freshness?",
    "In the case of a cache where all or part of the data is predictable, a warm-up mechanism can also be set up: it is in fact a pre-load of the cache, before making it accessible to applications, to avoid high latencies during the first cache calls.",
    "Rationale: Languages or frameworks oriented towards concurrency (often called \"asynchronous\") rather than parallelism (multithreading) will monopolize less physical resources during I/O waiting phases, such as API or database calls.",
    "Recommendation: Do not store unnecessary information:",
    "Monitor data usage to clean information which has become useless.",
    "On top of quality problems at the application level, the processing required to restore consistency and work around these inconsistencies requires computing resources (energy and hardware) that can be avoided",
    "Recommendation: Keep your data consistent by ensuring data collection follows the same validation rules through all channels.",
    "Map different uses of data (know which systems/user consume it, that will help to avoid data replication by ensuring proper access to it).",
    "For short life data like user interaction, data should be purged after 3 months,",
    "Billing data should be purged after 10 years",
    "In any case, legal requirements on data retention must be followed",
    "The data center can consume more energy to maintain tolerable temperature and humidity thresholds.",
    "It will then be the responsibility of the operations team to keep the document alive as the deployed infrastructure evolves."
  ],
  "Development, test and integration tools": [
    "If you have any comment or idea to improve it, you are most welcome to join our effort and can contact us through the Soft#008000 Plazza group or directly (see the list of authors at the end of this document).",
    "In order to make the discussion easier, we classify architecture styles in several board categories.",
    "The provision of resources without constraints should not lead to over-consumption.",
    "Configure your CPU and RAM requirements correctly (min, max, requested).",
    "Recommendation: Set up an appropriate scheduling of deployment and testing tools (Jenkins, GitLab CI, CircleCI, etc.).",
    "BACKEND-DTIT-06: Do not run continuous integration on every code commit",
    "Recommendation: Ask yourself at each code commit whether launching the CI and tests is really necessary.",
    "Recommendation: Add a manual deployment step involving a conscious request and not an automatic one.",
    "Rationale: All the tools in the build and deployment chain store artifacts (build artifacts, docker images, deployment configurations, etc.).",
    "Recommendation: The entire tool chain must be purged regularly to keep only what is needed.",
    "Typically test or dev environments should be switched of at night and during week-ends.",
    "Disconnect battery-operated test devices from the charger as soon as the charging time has elapsed.",
    "They do not contain package managers, shells or any other programs you would expect to find in a standard Linux distribution.",
    "In addition to avoid external file transfers from the internet, this prevents rate limits that may occur from external repositories",
    "test and QA servers and VMs"
  ],
  "Operations and End of Life": [
    "Monitor the volume of stored data to ensure your purge is working and/or detect an abnormal increase in objects sizes.",
    "However, users still have to deal with container orchestration, which can be complex.",
    "Recommendation: You can easily optimize the size of container image, by using different solutions:",
    "Recommendation: The principle of this recommendation is to limit the volume of logs transmitted to a minimum.",
    "It is necessary to take advantage of the features offered by the log management libraries by assigning a level of importance to each log message.",
    "Recommendation: Do not overestimate your operational needs (SLA) to avoid unnecessary technical, financial and human costs.",
    "It is unnecessary to be deployed on a bi-site infra if your SLA is low.",
    "Rationale: In the spirit of the previous recommendation, it is desirable to choose technologies that allow autoscaling.",
    "Recommendation: The principle is therefore, once upscaling and downscaling are possible, to automate these operations to allow automatic scaling in order to adapt the sizing (vertical scaling) and/or the number of instances (horizontal scaling) of the deployment of the application in real time.",
    "Use trace sampling to reduce data storage and network utilization (see link in reference). With sampling, you can trace a percentage of traffic an/or trace only when needed.",
    "BACKEND-EOL-2: delete unused VMs on projects that do not evolve any more"
  ]
}